<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>linkr</title>
    <link rel="stylesheet" href="style/main.css" type="text/css">
    <link rel="stylesheet" href="style/jquery-ui-1.8.4.custom.css" type="text/css">
    <link rel="alternate" type="application/atom+xml" 
      title="Atom Feed" href="/feed.atom"/>
    <script type="text/javascript" src="http://use.typekit.com/ldb0sgk.js"></script>
    <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
          

  </head>
  <body>
    <div id="main">
      <div id="header">
        <div id="account"></div>

        <h1>help, we need a <em>linkr!</em><sup class="note">(and a designer tooâ€¦)</sup></h1>

        <ul id="scopes"></ul>

        <div id="users"></div>
        
        <div id="profile"></div>
      </div>
      <div id="contentwrapper">
        <div id="sidebar">
          <div id="cloudcontrol"></div>
          <div id="tabs-1" class="tab"></div>
          <div id="tabs-2" class="tab"></div>
        </div>
        <div id="links"></div>
      </div>
      <div id="footer"></div>
    </div>
  </body>
  <script src="vendor/couchapp/loader.js"></script>
  <script type="text/javascript" charset="utf-8">
    couchapp_load([
        "vendor/couchapp/jquery.pathbinder.js",
        "script/jquery-ui-1.8.4.custom.min.js"
    ]);
    $.couch.app(function(app) {
        $$("#users").profiles = {};
        $$("#profile").unseen = [];
        $.couch.userDb(function(db) {
            db.allDocs({
              startkey : "org.couchdb.user:",
              endkey : "org.couchdb.user:\ufff0",
              include_docs : true,
              success: function(resp) {
              $.each(resp.rows, function(i, row) {
                  var profile = row.doc["couch.app.profile"];
                  if(profile) {
                  $$("#users").profiles[row.doc.name] = {};
                  $$("#users").profiles[row.doc.name].gravatar_url = profile.gravatar_url;
                  }
                });

                $("#account").evently("account", app);
                var profile = app.ddoc.evently.profile;
                profile.pushForm = $.extend(true, {}, profile.urlForm, profile.pushForm);
                profile.pullForm = $.extend(true, {}, profile.urlForm, profile.pullForm);
                profile.glued = $.extend(true, {}, profile.timeline, profile.glued);

                $("#profile").evently(profile, app);
                $.evently.connect("#account","#profile", ["loggedOut","loggedIn"]);
                var links = app.ddoc.evently.links;
                links.home = $.extend(true, {}, links.timeline, links.home);
                links.replies = $.extend(true, {}, links.timeline, links.replies);
                links.mentions = $.extend(true, {}, links.timeline, links.mentions);
                links.tags = $.extend(true, {}, links.timeline, links.tags);
                links.domains = $.extend(true, {}, links.timeline, links.domains);
                links.glued = $.extend(true, {}, links.timeline, links.glued);
                links.public = $.extend(true, {}, links.timeline, links.public);
                $("#links").evently(links, app);
                $("#scopes").evently("scopes", app); 
                $("#cloudcontrol").evently("cloudcontrol", app);
                $("#sidebar").tabs({ fx : { opacity: 'toggle' }, duration : 'fast'});
                $("#tabs-1").evently("tagcloud", app);
                $("#tabs-2").evently("domaincloud", app);
                $.evently.connect("#profile","#scopes", ["loggedOut","loggedIn"]);
                // Add a 'public' evently for loggedin/loggedout state to handle this
                $.evently.connect("#links","#profile", ["timeline","glued"]);
                $.evently.connect("#links","#account", ["loggedOut"]);
               // $.evently.connect("#account","#profile", ["noProfile"]);
                $.pathbinder.begin("/");
              }
            });
        });

        },{design: "linkr", db: "ocean"});
</script>
    </html>
